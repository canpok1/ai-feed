# 文書化ルール

このドキュメントは、ai-feedプロジェクトにおける文書化の基準とベストプラクティスをまとめたものです。

## 1. 基本原則

### 1.1 5W1Hフレームワーク

すべての文書は以下の観点を適切にカバーすること。

| 要素 | 説明 | 例 |
|------|------|-----|
| What（何を） | 変更・実装の核心的な内容 | 「記事レコメンド機能を実装」 |
| Why（なぜ） | 背景や目的 | 「ユーザーの記事発見を支援するため」 |
| How（どのように） | 主要なアプローチや技術的選択 | 「コサイン類似度を使用」 |
| Where（どこに） | 影響を受けるコンポーネント | 「internal/domain, cmd/recommend」 |
| When（いつ） | タイムライン（必要に応じて） | 「v1.2.0リリースに含める」 |
| Who（誰が） | 担当者・レビュアー（必要に応じて） | 「@developer」 |

### 1.2 記述言語

- **すべての文書は日本語で記述**
- 技術用語は英語のまま使用可（例: API, HTTP, JSON）

### 1.3 文書の品質基準

| 基準 | 説明 |
|------|------|
| 明確性 | 専門知識がなくても理解できる |
| 完全性 | 必要な情報が全て含まれている |
| 簡潔性 | 必要最小限の言葉で表現されている |
| 構造化 | 論理的な順序で整理されている |
| 正確性 | 技術的な誤りがない |

## 2. 出力形式パターン

### 2.1 プルリクエスト用

`.github/pull_request_template.md`に準拠した形式を使用する。

```markdown
## 概要
[変更内容の簡潔な要約（1-3文）]

## 変更内容
[主要な変更点を箇条書きで記載]
- `ファイル名`: 変更内容の説明
- `ファイル名`: 変更内容の説明

## 技術的選択・実装の詳細（必要に応じて）
[重要な技術的判断や実装のアプローチを説明]

## テスト（必要に応じて）
[追加・更新したテスト、カバレッジ情報]

## 関連Issue
fixed #(issue番号)
```

**重要な注意事項**:
- PRタイトルにはissue番号を含めない
- 関連issueがある場合は`fixed #番号`の形式で記載

### 2.2 GitHub Issue用

```markdown
## 問題・要望
[何が問題か、何を実現したいか（1-2文で簡潔に）]

## 詳細
[背景情報や具体的な状況]

### 再現手順（バグの場合）
1. [手順1]
2. [手順2]

### 原因（分かっている場合）
[問題の原因]

### 影響範囲
[影響を受けるコンポーネントやファイル]

## 期待される結果
[対応後にどうなるべきか、期待される動作]

## 技術的な実装の方向性（必要に応じて）
[実装のアプローチや技術的選択肢]
```

### 2.3 作業記録用

```markdown
## 作業内容
[日付]: [作業の要約]

### 実施項目
- [項目1]
- [項目2]

### 結果・成果
[達成できたこと]
```

## 3. 品質基準と比較例

### 3.1 良い例と悪い例

#### 概要の書き方

| 区分 | 例 |
|------|-----|
| Good | 「記事のレコメンデーション機能を実装しました。ユーザーの閲覧履歴に基づいて関連記事を提案します。」 |
| Bad | 「新機能を追加しました。」 |

**理由**: 具体的に何を実装したか、どのような動作かが明確

#### 変更内容の記載

| 区分 | 例 |
|------|-----|
| Good | `internal/usecase/recommend.go`: 類似度計算アルゴリズムの追加 |
| Bad | いくつかのファイルを変更しました |

**理由**: どのファイルに何の変更があったかが明確

#### エラー報告

| 区分 | 例 |
|------|-----|
| Good | 「HTTP クライアントのタイムアウト設定が5秒と短く、大きなレスポンスを処理しきれない」 |
| Bad | 「エラーが発生する」 |

**理由**: 原因と状況が具体的に説明されている

### 3.2 避けるべき表現

| 避けるべき表現 | 改善例 |
|---------------|--------|
| 「いくつかの」「多分」 | 具体的な数値や確定的な表現 |
| 過度に長い文章（3行以上） | 1文は2行以内を目安 |
| 受動態の多用 | 能動態を優先 |
| 専門用語の羅列 | 必要に応じて説明を追加 |

## 4. エージェント連携ワークフロー

### 4.1 推奨される使用フロー

```
┌─────────────────────────────────────────────────────┐
│ 1. コード実装・修正を完了                            │
└─────────────────┬───────────────────────────────────┘
                  ▼
┌─────────────────────────────────────────────────────┐
│ 2. レビューエージェントでコードの品質をチェック        │
│    - coding-rules-reviewer                          │
│    - architecture-rules-reviewer                    │
│    - testing-rules-reviewer                         │
└─────────────────┬───────────────────────────────────┘
                  ▼
┌─────────────────────────────────────────────────────┐
│ 3. レビュー指摘事項があれば対応                       │
└─────────────────┬───────────────────────────────────┘
                  ▼
┌─────────────────────────────────────────────────────┐
│ 4. document-specialistで作業全体を要約               │
│    - PR説明文の生成                                  │
│    - Issue説明文の生成                               │
└─────────────────┬───────────────────────────────────┘
                  ▼
┌─────────────────────────────────────────────────────┐
│ 5. プルリクエスト/Issueを作成                        │
└─────────────────────────────────────────────────────┘
```

### 4.2 エージェントの役割分担

| エージェント | 役割 |
|-------------|------|
| coding-rules-reviewer | コードの品質、命名規則、エラーハンドリングの確認 |
| architecture-rules-reviewer | レイヤリング、依存関係、設計パターンの確認 |
| testing-rules-reviewer | テストカバレッジ、テストパターンの確認 |
| document-specialist | 作業内容の文書化、PR/Issue説明文の生成、文書化ルールへの準拠確認 |

**補足**: `document-specialist`は、作業内容を要約・文書化する機能に加えて、作成された文書が本ドキュメント（`docs/07_document_rules.md`）で定義された文書化基準に従っているかをレビューする機能も持ちます。これにより、一貫性のある高品質な文書を保証します。

## 5. 実践的な例

### 5.1 プルリクエスト作成例

**入力コンテキスト**:
- レコメンデーション機能の実装完了
- internal/usecase/recommend.go、internal/domain/article.go、cmd/recommend/main.goを変更

**生成される説明文**:

```markdown
## 概要
記事のレコメンデーション機能を実装しました。ユーザーの閲覧履歴に基づいて、関連性の高い記事を提案します。

## 変更内容
- `internal/usecase/recommend.go`: レコメンデーションロジックの実装
  - 類似度計算アルゴリズムの追加
  - キャッシュ機構の導入
- `internal/domain/article.go`: Article構造体にタグフィールドを追加
- `cmd/recommend/main.go`: レコメンドコマンドのエントリーポイント追加

## 技術的選択・実装の詳細
- 類似度計算にはコサイン類似度を採用
- キャッシュにはメモリ内キャッシュを使用

## テスト
- ユニットテスト追加: `internal/usecase/recommend_test.go`
- カバレッジ: 85%

## 関連Issue
fixed #123
```

### 5.2 Issue作成例

**入力コンテキスト**:
- 記事取得時にHTTP 500エラーが発生
- タイムアウト設定が原因

**生成される説明文**:

```markdown
## 問題・要望
記事取得時にHTTP 500 Internal Server Errorが断続的に発生しています。

## 詳細
### 再現手順
1. 大量の記事（100件以上）を含むフィードを登録
2. `make run option="fetch"`を実行
3. 一部の記事取得で500エラーが発生

### 原因
HTTPクライアントのタイムアウト設定が5秒と短く、大きなレスポンスを処理しきれない。

### 影響範囲
- `internal/infrastructure/http_client.go`のタイムアウト設定
- 外部API呼び出しを行う全てのユースケース

## 期待される結果
- タイムアウト設定を30秒に延長
- タイムアウト値を設定ファイルで変更可能にする
```

## 6. チェックリスト

### 6.1 文書作成前

- [ ] 5W1Hが適切にカバーされているか確認
- [ ] 適切な出力形式（PR/Issue/作業記録）を選択

### 6.2 文書作成後

- [ ] 技術用語が正確に使用されているか
- [ ] マークダウン形式が正しいか
- [ ] 文章が簡潔で読みやすいか
- [ ] プロジェクト固有のルールに従っているか
  - [ ] PRタイトルにissue番号を含めていないか
  - [ ] 関連issueが`fixed #番号`形式で記載されているか
- [ ] 日本語で記述されているか

### 6.3 不明点がある場合

- 明確にどの情報が不足しているかを指摘
- その情報がなぜ重要かを説明
- 可能な範囲で暫定的な文書を提供
- 追加情報を得た後に更新することを提案

## 関連ドキュメント

- [開発環境セットアップ](./00_development_setup.md)
- [コーディングルール](./01_coding_rules.md)
- [アーキテクチャ概要](./02_architecture_rules.md)
- [テストガイド](./03_testing_rules.md)
- [コントリビューションガイド](./04_contributing.md)
